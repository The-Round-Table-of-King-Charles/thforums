{% extends 'layout.html' %}
{% block content %}
<div class="container">
    <div class="card p-4 mb-4 medieval-card shadow" style="background: #fffbe7; border-radius: 16px; border: 3px solid #bfa14a;">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="mb-0 tavern-sign-straight"><i class="fas fa-shield-halved me-2"></i>{{ guild.guild_name }}</h2>
            {% if guild.is_owner(current_user) %}
                <div>
                    <a href="{{ url_for('guild_edit') }}" class="btn btn-outline-medieval me-2"><i class="fas fa-cog"></i> Settings</a>
                    <a href="{{ url_for('guild_transfer') }}" class="btn btn-outline-medieval"><i class="fas fa-user-shield"></i> Transfer Ownership</a>
                </div>
            {% endif %}
        </div>
        <p class="mt-3" style="color:#3a3226;">{{ guild.content }}</p>
        <hr>
        <h4 style="color:#bfa14a;">Members ({{ guild.member_count() }})</h4>
        <ul class="list-group">
            {% for member in members %}
                <li class="list-group-item d-flex justify-content-between align-items-center" style="background: #f9f5e3;">
                    <span>
                        <img src="{{ url_for('static', filename='profile_pics/' + (member.image_file or 'default.png')) }}" class="rounded-circle" style="width:32px; height:32px; margin-right:8px;">
                        <span style="color:#5a4633;">{{ member.username }}</span>
                        {% if guild.owner_id == member.id %}
                            <span class="badge bg-warning text-dark">Owner</span>
                        {% endif %}
                    </span>
                    {% if guild.is_owner(current_user) and member.id != current_user.id %}
                        <form method="POST" action="{{ url_for('guild_remove_member', user_id=member.id) }}" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove this member?')">Remove</button>
                        </form>
                    {% elif member.id == current_user.id and not guild.is_owner(current_user) %}
                        <form method="POST" action="{{ url_for('guild_leave') }}" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Leave this guild?')">Leave</button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
