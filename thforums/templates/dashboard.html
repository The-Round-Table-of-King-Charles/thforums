{% extends 'layout.html' %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 tavern-sign-straight"><i class="fas fa-fire me-2"></i>Latest Threads</h2>
    {% if threads.items %}
        <div class="list-group">
            {% for thread in threads.items %}
                <div class="thread-dashboard-entry medieval-card mb-3 shadow-sm">
                    <div class="d-flex align-items-stretch px-3 py-3" style="background: #f8f5f0; border-radius: 8px;">
                        <div class="d-flex flex-column align-items-center justify-content-center mx-2" style="min-width: 90px;">
                            <img src="{{ url_for('static', filename='profile_pics/' ~ thread.author.image_file) }}" alt="User" class="rounded-circle border border-3 border-medieval mb-2" style="width:64px; height:64px; object-fit:cover;">
                            <div class="fw-bold text-center" style="font-size:0.98em;">{{ thread.author.username }}</div>
                            <div class="text-muted" style="font-size:0.85em;">Lv. {{ thread.author.level }}</div>
                        </div>
                        <!-- Vertical separator -->
                        <div class="vr mx-3" style="min-height: 80px; border-color: #bfa14a; opacity: 0.7;"></div>
                        <div class="flex-grow-1 d-flex flex-column justify-content-between">
                            <div>
                                <div class="mb-1">
                                    <span class="thread-dashboard-title fw-bold" style="font-size:1.45em; color:#3a3226;">
                                        {{ thread.title }}
                                    </span>
                                </div>
                                <div class="d-flex align-items-center mb-1">
                                    <span class="badge bg-medieval me-2" style="font-size:0.95em;">
                                        <i class="fas fa-folder-open me-1"></i>{{ thread.category }}
                                    </span>
                                </div>
                                <div class="text-muted mb-2" style="font-size:0.95em;">
                                    Posted {{ thread.date_posted.strftime('%b %d, %Y %H:%M') }}
                                    {% if thread.edited %}
                                        <span class="badge bg-secondary ms-2">Edited</span>
                                    {% endif %}
                                </div>
                                <div class="mb-2" style="color:#5a4633;">
                                    {{ thread.content[:220] }}{% if thread.content|length > 220 %}...{% endif %}
                                </div>
                                {% if thread.tags %}
                                    <div class="mt-1">
                                        {% for tag in thread.tags %}
                                            <span class="badge bg-warning text-dark me-1">{{ tag.name }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="d-flex align-items-center mt-2" style="font-size:0.95em;">
                                <span class="me-3"><i class="fas fa-comments"></i> {{ thread.replies|length }} Replies</span>
                                <span class="me-3"><i class="fas fa-star"></i> {{ thread.commend_count() }} Commends</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <!-- Pagination -->
        <div class="pagination mt-4">
            {% if threads.pages > 1 %}
                {% if threads.has_prev %}
                    <a href="{{ url_for('home', page=threads.prev_num) }}" class="btn btn-medieval prev-next me-2">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="d-none d-md-inline"> Prev</span>
                    </a>
                {% endif %}
                {% for page_num in threads.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <a href="{{ url_for('home', page=page_num) }}"
                           class="btn btn-sm {{ 'btn-medieval' if page_num == threads.page else 'btn-outline-medieval' }} me-1">
                            {{ page_num }}
                        </a>
                    {% else %}
                        <span class="btn btn-sm btn-outline-medieval disabled me-1" tabindex="-1">â€¦</span>
                    {% endif %}
                {% endfor %}
                {% if threads.has_next %}
                    <a href="{{ url_for('home', page=threads.next_num) }}" class="btn btn-medieval prev-next ms-2">
                        <span class="d-none d-md-inline">Next </span>
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                {% endif %}
            {% endif %}
        </div>
    {% else %}
        <div class="alert alert-info">No threads found.</div>
    {% endif %}
</div>
{% endblock %}
